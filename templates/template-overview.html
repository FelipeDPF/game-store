<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link href="https://fonts.googleapis.com/css?family=Megrim|Nunito+Sans:400,900" rel="stylesheet" />
    <link rel="icon"
        href="https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/apple/155/ear-of-maize_1f33d.png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

    <title>GAME STORE</title>

    <link rel="stylesheet" href="/styles/style.css" />
</head>

<body>
    <div class="container">
        <h1>üéÆ GAME STORE üïπÔ∏è</h1>

        <!-- Grid/List Toggle -->
        <div class="view-toggle">
            <button onclick="setView('grid')" title="Grid View">
                <i class="fas fa-th-large"></i>
            </button>
            <button onclick="setView('list')" title="List View">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- Card Container -->
        <div class="cards-container grid" id="cardView">
            {%PRODUCT_CARDS%}
        </div>
    </div>

    <script>
        // Expand/collapse a single card
        document.querySelectorAll('.see-more-btn').forEach(button => {
            button.addEventListener('click', e => {
                e.preventDefault();

                const card = button.closest('.card');
                const cardMore = card.querySelector('.card_more');

                // Collapse all other cards
                document.querySelectorAll('.card.expanded').forEach(otherCard => {
                    if (otherCard !== card) {
                        otherCard.classList.remove('expanded');
                        const otherMore = otherCard.querySelector('.card_more');
                        if (otherMore) otherMore.classList.add('hidden');

                        const otherBtn = otherCard.querySelector('.see-more-btn');
                        if (otherBtn) otherBtn.textContent = 'See more';
                    }
                });

                // Toggle current card
                const isExpanding = !card.classList.contains('expanded');
                card.classList.toggle('expanded', isExpanding);
                cardMore.classList.toggle('hidden', !isExpanding);
                button.textContent = isExpanding ? 'See less' : 'See more';
            });
        });

        // Rating styling logic
        document.querySelectorAll('.rating-value').forEach(span => {
            const rawValue = span.getAttribute('data-rating');
            const rating = parseFloat(rawValue);

            if (rating < 5) {
                span.innerHTML = `<span class="rating-value rating-red">üíÄ ${rating}</span>`;
            } else if (rating >= 7.5) {
                span.innerHTML = `<span class="rating-value rating-gold">‚≠ê ${rating}</span>`;
            } else {
                span.innerHTML = `<span class="rating-value rating-neutral">${rating}</span>`;
            }
        });

        // View toggle (Grid/List)
        function setView(mode) {
            const container = document.getElementById('cardView');

            // Reset all expanded cards when changing view
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('expanded');
                const more = card.querySelector('.card_more');
                if (more) more.classList.add('hidden');

                const toggleBtn = card.querySelector('.see-more-btn');
                if (toggleBtn) toggleBtn.textContent = 'See more';
            });

            container.classList.remove('grid', 'list');
            container.classList.add(mode);
        }
    </script>
</body>

</html>